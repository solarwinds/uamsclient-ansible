---
- name: Check if UAMS Client is installed (Windows)
  ansible.windows.win_shell: |
    (get-wmiobject win32_product -Filter "Name LIKE '%uams client%'").IdentifyingNumber
  register: client_installed_result
  changed_when: false

- name: Evaluate UAMS Client installed fact (Windows)
  ansible.builtin.set_fact:
    client_installed: '{{ client_installed_result.stdout | trim }}'

- name: Set new version to be installed if uamsclient is not installed
  ansible.builtin.set_fact:
    install_new_version: true
  when: client_installed == ''

- name: Retrieve service details if uamsclient is installed
  ansible.windows.win_service_info:
    name: WinRM
  register: service_info

- name: "Display"
  debug:
    msg: "{{ service_info }}"
