version: 2.1

commands:
  install-client-ubuntu:
    steps:
      - checkout
      - run: |
          apt update
          apt install python3-pip -y
          apt install curl -y
          pip3 install ansible
          sed -i 's/<group_name>/test/' playbook.yaml
          cp ci_test/inventory/localhost ./hosts
          ansible-playbook playbook.yaml -i hosts

jobs:
  ansible-lint:
    docker:
      - image: python:bullseye
    steps:
      - checkout
      - run: pip install ansible-lint
      - run: ansible-lint -v playbook.yaml

  test-install-ubuntu-focal:
    docker:
      - image: ubuntu:focal
    steps:
      - install-client-ubuntu

  test-install-ubuntu-jammy:
    docker:
      - image: ubuntu:jammy
    steps:
      - install-client-ubuntu

  test-install-ubuntu-bionic:
    docker:
      - image: ubuntu:bionic
    steps:
      - install-client-ubuntu

workflows:
  test-uamsclient-role:
    jobs:
      - ansible-lint
      - test-install-ubuntu-focal
      - test-install-ubuntu-jammy
      - test-install-ubuntu-bionic
