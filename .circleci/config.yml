version: 2.1

commands:
  install-client-ubuntu-debian:
    steps:
      - checkout
      - run: |
          export LANG=C.UTF-8
          export LC_ALL=C.UTF-8
          apt update
          apt install python3-pip -y
          apt install curl -y
          pip3 install ansible
          sed -i 's/<group_name>/test/' playbook.yaml
          cp ci_test/inventory/localhost ./hosts
          ansible-playbook playbook.yaml -i hosts
  install-client-redhat:
    steps:
      - checkout
      - run: |
          yum -y install epel-release
          yum -y install ansible
          sed -i 's/<group_name>/test/' playbook.yaml
          cp ci_test/inventory/localhost ./hosts
          ansible-playbook playbook.yaml -i hosts

  install-client-fedora:
    steps:
      - checkout
      - run: |
          dnf -y install ansible
          sed -i 's/<group_name>/test/' playbook.yaml
          cp ci_test/inventory/localhost ./hosts
          ansible-playbook playbook.yaml -i hosts

jobs:
  ansible-lint:
    docker:
      - image: python:bullseye
    steps:
      - checkout
      - run: pip install ansible-lint
      - run: ansible-lint -v playbook.yaml

  test-install-ubuntu-focal:
    docker:
      - image: ubuntu:focal
    steps:
      - install-client-ubuntu-debian

  test-install-ubuntu-jammy:
    docker:
      - image: ubuntu:jammy
    steps:
      - install-client-ubuntu-debian

  test-install-ubuntu-bionic:
    docker:
      - image: ubuntu:bionic
    steps:
      - install-client-ubuntu-debian

  test-install-debian-stretch:
    docker:
      - image: debian:stretch
    steps:
      - install-client-ubuntu-debian

  test-install-debian-buster:
    docker:
      - image: debian:buster
    steps:
      - install-client-ubuntu-debian

  test-install-debian-bullseye:
    docker:
      - image: debian:bullseye
    steps:
      - install-client-ubuntu-debian

  test-install-centos-7:
    docker:
      - image: centos:centos7
    steps:
      - install-client-redhat

  test-install-fedora-32:
    docker:
      - image: fedora:32
    steps:
      - install-client-fedora

  test-install-fedora-36:
    docker:
      - image: fedora:36
    steps:
      - install-client-fedora

  test-install-kali:
    docker:
      - image: kalilinux/kali-rolling
    steps:
      - install-client-ubuntu-debian



workflows:
  test-uamsclient-role:
    jobs:
      - ansible-lint
      # - test-install-ubuntu-focal
      # - test-install-ubuntu-jammy
      # - test-install-ubuntu-bionic
      # - test-install-debian-stretch
      # - test-install-debian-buster
      # - test-install-debian-bullseye
      # - test-install-centos-7
      # - test-install-fedora-32
      # - test-install-fedora-36
      - test-install-kali